{% extends "base.html" %}
{% block title %}Applications{% endblock %}

{% block content %}
  <div class="page-title">
    <h1>Applications</h1>
    <span class="badge">{{ filtered_count }} / {{ total_count }}</span>
  </div>

  <p class="muted">Search and filter the portfolio by key attributes.</p>

  <div class="card">
    <form method="get">
      <div class="form-row">
        <div>
          <label class="muted">Search</label>
          <input type="text" name="q" placeholder="Name, vendor, stack..." value="{{ filters.q }}" />
        </div>

        <div>
          <label class="muted">Domain</label>
          <select name="domain">
            <option value="">All</option>
            {% for x in domains %}
              <option value="{{ x }}" {% if filters.domain == x %}selected{% endif %}>{{ x }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="muted">Criticality</label>
          <select name="criticality">
            <option value="">All</option>
            {% for x in criticalities %}
              <option value="{{ x }}" {% if filters.criticality == x %}selected{% endif %}>{{ x }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="form-row" style="margin-top:12px;">
        <div>
          <label class="muted">Environment</label>
          <select name="environment">
            <option value="">All</option>
            {% for x in environments %}
              <option value="{{ x }}" {% if filters.environment == x %}selected{% endif %}>{{ x }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="muted">Region</label>
          <select name="region">
            <option value="">All</option>
            {% for x in regions %}
              <option value="{{ x }}" {% if filters.region == x %}selected{% endif %}>{{ x }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="muted">Hosting</label>
          <select name="hosting">
            <option value="">All</option>
            {% for x in hostings %}
              <option value="{{ x }}" {% if filters.hosting == x %}selected{% endif %}>{{ x }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="form-row" style="margin-top:12px;">
        <div>
          <label class="muted">Vendor</label>
          <select name="vendor">
            <option value="">All</option>
            {% for x in vendors %}
              <option value="{{ x }}" {% if filters.vendor == x %}selected{% endif %}>{{ x }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label class="muted">Data sensitivity</label>
          <select name="sensitivity">
            <option value="">All</option>
            {% for x in sensitivities %}
              <option value="{{ x }}" {% if filters.sensitivity == x %}selected{% endif %}>{{ x }}</option>
            {% endfor %}
          </select>
        </div>

        <div style="display:flex; gap:10px; align-items:end;">
          <button class="btn btn-primary" type="submit">Apply filters</button>
          <a class="btn btn-ghost" href="{% url 'app_list' %}">Reset</a>
        </div>
      </div>
    </form>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>App</th>
          <th>Domain</th>
          <th>Criticality</th>
          <th>Environment</th>
          <th>Region</th>
          <th>Vendor</th>
          <th>Tech debt</th>
        </tr>
      </thead>
      <tbody>
        {% for app in apps %}
          <tr>
            <td><a href="{% url 'app_detail' app.id %}">{{ app.name }}</a></td>
            <td>{{ app.domain }}</td>
            <td>{{ app.criticality }}</td>
            <td>{{ app.environment }}</td>
            <td>{{ app.region }}</td>
            <td>{{ app.vendor }}</td>
            <td>{{ app.tech_debt_score }}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="7" class="muted">No applications found.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}